# .NET Code and Package Signing Demo

This demo shows building, packaging, signing and releasing a .NET project using
github actions. The action signs both .NET assemblies and nuget packages. The
github actions use a self signed cert generated with `openssl`.

## THIS IS NOT SECURE - DEMO ONLY - NOT PRODUCTION

This is a self signed key. It is not secure for production. The keys used here
are for demonstrating the signing process. In production, the signing key(s)
would be from a real CA like digicert and be kept in a secure location like AWS
KMS, Hashicorp Vault, or an HSM. And the keys for the assemblies and package
would probably be different keys. There will be substantial rigor around the
handling of keys in production.

## Windows

The `Windows Runner` (windows.yml) runs in a github Windows Server runner. It
takes the repo from code to release. In addition to generating the certificate
with openssl, the certificate is added to the Local Machine's (the runner's)
Trust Root Certification Authorities store. Such that the chain of trust is
valid for nuget to sign the package with the self signed cert.

1. Checkout code
2. Generate Certificates
   1. Generate CA key
   2. Generate CA cert
   3. Generate signing key
   4. Generate signing CSR
   5. Sign CSR with CA key to generate signing cert
   6. Convert signing key and cert to pkcs12/p12/pfx (windows) format
   7. Convert CA key and cert to pkcs12/p12/pfx (windows) format
   8. Import CA pfx file into Local Machine Trusted Root Certificate Authorities
   9. Convert the signing key to a `.snk` file for .NET strong name (`sn.exe`)
3. Build `Program.csproj` (and sign assembly)
4. Run `Program` as a test harness
5. Package build into nuget nupkg
6. Sign package with `nuget sign`
7. Show the assembly signature
8. Show the nupkg signature
9. Zip package and PFX files
10. Release zip file as a github release

## Linux

The `Linux Runner` (linux.yml) is not feature complete due to limitations of the
Microsoft and .NET stack in non-windows operating systems. It stops short of
signing the nuget package in the list above. It's probably something I'm doing
wrong related to the pfx file.

It does use [osslsigncode](https://github.com/mtrojnar/osslsigncode) to sign the
assemblies.

## PKI Files

These are the files generated by openssl. They are created on the fly in the action
and not part of the repo (`.gitignore`).

* cert-ca.key - RSA key for the CA
* cert-ca.pem - X509 certificate for the CA
* cert.key - RSA key for the signer
* cert.csr - Certificate Signing Request for the CA to sign for the signer
* cert.pem - Signer X509 certificate signed by the CA
* cert.pfx - cert.key and cert.pem packaged as a pkcs12 package for windows
* cert-ca.pfx - cert-ca.key and cert-ca.pem packaged as a pkcs12 package for windows
* cert-key.snk - cert.key formatted as an msbuild SNK file for signing the assembly with `dotnet`
